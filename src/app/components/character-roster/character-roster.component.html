<div
  class="character-roster-container d-flex flex-column justify-content-center"
>
  <div class="d-none d-sm-flex flex-row justify-content-between w-50 m-auto">
    <img class="chain" src="/img/chain.png" />
    <img class="chain" src="/img/chain.png" />
  </div>
  <!--header-->
  <div
    id="character-roster"
    class="d-flex flex-column align-items-center roster-header w-100 align-self-center py-3 py-sm-2"
    (scroll)="onScrollTop($event)"
  >
    <h1 class="text-center p-2">Character Roster</h1>
    <div class="d-flex flex-column flex-sm-row justify-content-center w-100">
      <!--search, sort, filters-->
      <div
        class="d-flex flex-row justify-content-center justify-content-sm-start my-3 mx-0 mx-sm-3"
      >
        <!--filter by button that opens modal-->
        <div class="mt-auto search-bar">
          <input
            type="search"
            name="characterSearchBar"
            id="characterSearchBar"
            type="search"
            placeholder="Find a hero..."
            (keyup)="searchCharacterRoster(filter.value)"
            #filter
            data-bs-toggle="tooltip"
            data-bs-placement="bottom"
            title="Search by name, class, species, or background"
          />
        </div>
        <!--sort by button-->
      </div>
    </div>
  </div>

  <!--floating buttons-->
  <div class="floating-buttons d-none d-sm-flex flex-column align-items-center">
    <!--scroll to top-->
    @if (loadLimit! > loadDefault) {

    <button
      class="scroll-to-top mb-2 mb-sm-3"
      (click)="scrollToTop()"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Scroll to top"
    >
      <img src="/img/up-arrow.png" />
    </button>
    }
    <!--add characters-->
    <a
      class="text-decoration-none"
      routerLink="/create-a-character"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="Add Character"
    >
      <img src="/img/document-sealed.png" />
      <span class="plus-sign">+</span>
    </a>
  </div>

  <!--list of characters-->
  @if (filteredCharacterList$ && filteredCharacterList$.length > 0){

  <section
    name="character-list"
    class="character-list d-flex flex-column align-items-center"
    infiniteScroll
    [infiniteScrollDistance]="2"
    [infiniteScrollThrottle]="50"
    (scrolled)="onScroll()"
  >
    <!--iterate through character list-->
    @for(c of filteredCharacterList$; track $index;){
    <!--variables to track index-->
    @let characterIndex = 'character-index-' + $index;
    <!--variables to for id-->
    @let characterIndexTarget = '#' + characterIndex;
    <!--load limit; default = 5-->
    @if ($index <= loadLimit! - 1){
    <div
      class="w-100 my-0 my-sm-4 roster-scroll-container"
      data-bs-toggle="collapse"
      [attr.data-bs-target]="characterIndexTarget"
    >
      <img
        class="d-none d-sm-block w-100 roster-scroll-ends"
        src="img/scroll-top.png"
      />
      <div class="roster-scroll w-100">
        <div class="roster-scroll-content">
          <div class="d-flex flex-column character-details">
            <div class="d-flex flex-row justify-content-between">
              <h2>{{ c.characterName }}</h2>
              <!--buttons-->
              <div class="d-flex flex-row p-0">
                <!--edit button-->
                <button
                  class="ms-1 bg-transparent border-0 d-flex justify-content-center edit-button"
                  [routerLink]="['/edit-character', c.id]"
                  data-bs-toggle="tooltip"
                  title="Edit Character"
                >
                  <!-- <span class="d-block d-md-none p-0">Edit</span> -->
                  <img class="custom-icon my-auto" src="/img/edit-quill.png" />
                </button>
                <!--delete button-->
                <button
                  class="bg-transparent border-0 d-flex justify-content-center delete-button"
                  (click)="deleteCharacter(c.id, c.characterName)"
                  data-bs-toggle="tooltip"
                  title="Delete Character"
                >
                  <img class="custom-icon my-auto" src="/img/trash.png" />
                  <!-- <span class="d-block d-sm-none p-0">Delete</span> -->
                </button>
              </div>
            </div>
            <div class="d-flex flex-row flex-wrap">
              <span> {{ c.characterClass }}</span>
              <span> {{ c.characterSpecies }}</span>
              <span> {{ c.characterBackground }} </span>
            </div>
          </div>
          <div [id]="characterIndex" class="collapse">
            <!--ability scores-->
            <div
              class="ability-scores d-flex flex-row flex-wrap justify-content-between mt-3"
            >
              @if (c.abilityScores){ @let abilityScoresList =
              this.characterSheetService.getAbilityScores(c); @for (a of
              abilityScoresList; track $index){
              <div class="ability-score-box d-flex flex-column text-center">
                <strong class="ability-score-name">{{
                  abilityScoresList[$index][0].substring(0, 3)
                }}</strong>
                <p class="ability-score-value">
                  {{ abilityScoresList[$index][1] }}
                </p>
              </div>
              }}
            </div>
            <!--description-->
            <div
              class="d-flex flex-column flex-sm-row flex-wrap character-description"
            >
              @if (c.characterDescription){
              <div class="character-description-box">
                <strong class="character-description-header"
                  >Personality Traits</strong
                >
                <p class="character-description-text">
                  {{ c.characterDescription.personalityTraits }}
                </p>
              </div>
              <div class="character-description-box">
                <strong class="character-description-header">Ideals</strong>
                <p class="character-description-text">
                  {{ c.characterDescription.ideals }}
                </p>
              </div>
              <div class="character-description-box">
                <strong class="character-description-header">Bonds</strong>
                <p class="character-description-text">
                  {{ c.characterDescription.bonds }}
                </p>
              </div>
              <div class="character-description-box">
                <strong class="character-description-header">Flaws</strong>
                <p class="character-description-text">
                  {{ c.characterDescription.flaws }}
                </p>
              </div>
              }
            </div>
          </div>
        </div>
      </div>
      <img
        class="d-none d-sm-block w-100 roster-scroll-ends"
        src="img/scroll-bottom.png"
      />
    </div>
    }}
  </section>
  }

  <div
    class="d-flex d-sm-none w-100 position-static bottom-0 character-roster-bar"
  >
    <!--no characters-->
    @if (characterList$.length == 0) {
    <div class="bg-black text-white">
      Your roster is empty... click here to create a character
    </div>
    }
    <!--no character found-->
    @if (filteredCharacterList$.length == 0 && characterList$.length > 0){

    <div class="bg-black text-white">
      There are no characters that match your search
    </div>
    }
    <!--add character-->
    @if (characterList$.length > 0 || filteredCharacterList$.length > 0) {
    <!--change text based on stuff-->
    <div class="text-white">Add another character</div>
    }
  </div>
</div>
